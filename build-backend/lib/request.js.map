{"version":3,"file":"request.js","sourceRoot":"","sources":["../../src/lib/request.ts"],"names":[],"mappings":"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","sourcesContent":["// This module monkey-patches request for the sandbox\n// so unhandled errors in the callback or forgetting to\n// attach the error event handler does not bring down the adapter\n\nimport * as _request from 'request';\n\nlet logger: {\n    error: (e: string) => void;\n} = {\n    error: (e: string): void => console.error(e),\n};\n\nfunction requestError(error: Error | string): void {\n    logger.error(`Request error: ${error}`);\n}\n\n/**\n * Calls a request method which accepts a callback and handles errors in the request and the callback itself\n */\nfunction requestSafe(method: (..._args: any[]) => any, ...args: any[]): any {\n    const lastArg = args[args.length - 1];\n    if (typeof lastArg === 'function') {\n        // If a callback was provided, handle errors in the callback\n        const otherArgs = args.slice(0, args.length - 1);\n        return method(...otherArgs, (...cbArgs: any[]): void => {\n            try {\n                lastArg(...cbArgs);\n            } catch (err: unknown) {\n                logger.error(`Error in request callback: ${err as Error}`);\n            }\n        }).on('error', requestError);\n    }\n\n    // otherwise, just pass the call through\n    return method(...args).on('error', requestError);\n}\n\n// and request itself\n// @ts-expect-error fix later\nexport const request = (...args: any[]): any => requestSafe(_request, ...args);\n\nrequest.get = (...args: any[]): any => requestSafe(_request.get, ...args);\nrequest.post = (...args: any[]): any => requestSafe(_request.post, ...args);\nrequest.put = (...args: any[]): any => requestSafe(_request.put, ...args);\nrequest.head = (...args: any[]): any => requestSafe(_request.head, ...args);\nrequest.patch = (...args: any[]): any => requestSafe(_request.patch, ...args);\nrequest.del = (...args: any[]): any => requestSafe(_request.del, ...args);\nrequest.delete = (...args: any[]): any => requestSafe(_request.delete, ...args);\nrequest.initParams = (...args: any[]): any => requestSafe(_request.initParams, ...args);\n\n// And copy all other properties and methods\nrequest.defaults = _request.defaults;\nrequest.forever = _request.forever;\nrequest.jar = _request.jar;\nrequest.cookie = _request.cookie;\nrequest.debug = _request.debug;\n\nrequest.setLogger = function (_logger: { error: (e: string) => void }): void {\n    logger = _logger;\n};\n\n// end of monkeypatching\n"]}